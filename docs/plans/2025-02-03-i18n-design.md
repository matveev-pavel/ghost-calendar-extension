# Internationalization (i18n) Design

## Overview

Add multi-language support to Ghost Calendar extension with 10 languages.

## Requirements

- **Language detection**: Auto-detect from browser + manual override in settings
- **Technology**: Chrome i18n API (`chrome.i18n.getMessage()`)
- **Date formatting**: Intl.DateTimeFormat (browser-native)
- **Translations**: AI-generated (Claude Code)

## Supported Languages

| Code | Language | Native Name |
|------|----------|-------------|
| en | English | English |
| es | Spanish | EspaÃ±ol |
| zh_CN | Chinese (Simplified) | ç®€ä½“ä¸­æ–‡ |
| pt_BR | Portuguese (Brazil) | PortuguÃªs |
| ru | Russian | Ğ ÑƒÑÑĞºĞ¸Ğ¹ |
| de | German | Deutsch |
| fr | French | FranÃ§ais |
| ja | Japanese | æ—¥æœ¬èª |
| ko | Korean | í•œêµ­ì–´ |
| it | Italian | Italiano |

## Architecture

### File Structure

```
_locales/
â”œâ”€â”€ en/messages.json     (base, fallback)
â”œâ”€â”€ es/messages.json
â”œâ”€â”€ zh_CN/messages.json
â”œâ”€â”€ pt_BR/messages.json
â”œâ”€â”€ ru/messages.json
â”œâ”€â”€ de/messages.json
â”œâ”€â”€ fr/messages.json
â”œâ”€â”€ ja/messages.json
â”œâ”€â”€ ko/messages.json
â””â”€â”€ it/messages.json

lib/
â””â”€â”€ i18n.js              (helper functions)
```

### messages.json Format

```json
{
  "extName": {
    "message": "Ghost Calendar",
    "description": "Extension name"
  },
  "btnSave": {
    "message": "Save",
    "description": "Save button label"
  },
  "msgError": {
    "message": "Error: $1",
    "description": "Error message with details",
    "placeholders": {
      "1": { "content": "$1" }
    }
  }
}
```

### manifest.json Changes

```json
{
  "default_locale": "en",
  "name": "__MSG_extName__",
  "description": "__MSG_extDescription__"
}
```

## Implementation Details

### HTML Localization

Use `data-i18n` attributes for static text:

```html
<!-- Text content -->
<h1 data-i18n="optionsTitle">Settings</h1>
<button data-i18n="btnSave">Save</button>

<!-- Attributes -->
<input data-i18n-placeholder="searchPlaceholder" placeholder="Search...">
<button data-i18n-title="btnSettingsTitle" title="Settings">âš™ï¸</button>
```

### lib/i18n.js Helper

```javascript
// Get translation
function t(key, substitutions) {
  return chrome.i18n.getMessage(key, substitutions) || key;
}

// Apply translations to page
function applyTranslations() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.dataset.i18nPlaceholder);
  });
  document.querySelectorAll('[data-i18n-title]').forEach(el => {
    el.title = t(el.dataset.i18nTitle);
  });
}

// Get current locale
async function getCurrentLocale() {
  const { language } = await chrome.storage.local.get('language');
  return language || chrome.i18n.getUILanguage();
}
```

### Dynamic Strings in JS

```javascript
// Instead of hardcoded strings
showStatus(t('msgSaveSuccess'), 'success');
alert(t('msgDeleteConfirm', [count]));
```

### Date Localization

Replace hardcoded month array with Intl.DateTimeFormat:

```javascript
function getMonthName(date, locale) {
  return new Intl.DateTimeFormat(locale, { month: 'long' }).format(date);
}

function formatDate(date, locale) {
  return new Intl.DateTimeFormat(locale, {
    day: 'numeric',
    month: 'short',
    year: 'numeric'
  }).format(date);
}
```

## Language Selector UI

### Location

First field in Options page form.

### Design

```html
<div class="form-group">
  <label data-i18n="labelLanguage">Language</label>
  <select id="language">
    <option value="">ğŸŒ Auto (Browser)</option>
    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
    <option value="zh_CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
    <option value="pt_BR">ğŸ‡§ğŸ‡· PortuguÃªs</option>
    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
    <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
  </select>
</div>
```

### Behavior

1. Value saved to `chrome.storage.local` as `{ language: 'ru' }`
2. Empty value (`""`) = auto-detect from browser
3. On change: show message "Reload extension to apply"
4. Chrome i18n API reads language on page load â€” reload required

## Implementation Plan

### Phase 1: Infrastructure
- Create `_locales/en/messages.json` with all strings
- Add `default_locale` to manifest.json
- Create `lib/i18n.js` with helper functions

### Phase 2: Extract Strings
- Collect all hardcoded strings from HTML and JS files
- Group by category (UI, messages, errors)
- Create keys in messages.json (~150-200 strings)

### Phase 3: Refactor Files
- sidepanel.html/js â€” add data-i18n, replace strings with t()
- options.html/js â€” same + add language selector
- tags.html/js â€” same
- Replace month array with Intl.DateTimeFormat

### Phase 4: Translations
- Create messages.json for 9 languages
- AI-translate all strings

### Phase 5: Testing
- Verify each language
- Ensure fallback to English works

## String Categories

| Category | Example Keys | Count (est.) |
|----------|--------------|--------------|
| Extension meta | extName, extDescription | 2 |
| Navigation | btnList, btnCalendar, btnSettings | 10 |
| Forms | labelBlogUrl, labelApiKey, placeholderSearch | 15 |
| Buttons | btnSave, btnTest, btnDelete, btnCancel | 15 |
| Status messages | msgSaving, msgSaved, msgError | 20 |
| Validation | errRequired, errInvalidUrl, errInvalidKey | 15 |
| Empty states | emptyNoPosts, emptyNoTags | 5 |
| Loading states | loadingPosts, loadingTags | 5 |
| Modals | modalAddTag, modalDeleteConfirm | 15 |
| Tags UI | tabPublic, tabInternal, labelTagName | 20 |
| Filter UI | filterAny, filterAll, filterClear | 10 |
| Misc | other UI strings | ~20 |
| **Total** | | **~150-200** |
